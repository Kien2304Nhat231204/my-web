<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Trang qu·∫£n tr·ªã</title>
<link rel="stylesheet" href="style.css">
<style>
body {text-align:center; font-family:Segoe UI,sans-serif; background:#f4f4f4; margin:0; padding:0;}
.container {max-width:700px; margin:20px auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.2);}
input {margin:5px; padding:8px; width:200px;}
button {padding:8px 20px; margin-top:5px; cursor:pointer;}
hr {margin:20px 0;}
table {width:100%; border-collapse:collapse;}
th, td {border:1px solid #ccc; padding:8px; text-align:left;}
th {background:#003566; color:white;}
.user-table button {background:#d9534f; color:white; border:none; border-radius:4px;}
.user-table button:hover {background:#c9302c;}
.modal {position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; z-index:999;}
.modal-content {background:#fff; padding:20px; border-radius:10px; max-width:90%; max-height:80vh; overflow:auto; margin:50px auto; position:relative;}
.close-btn {position:absolute; top:10px; right:10px; background:#555; color:#fff; border:none; border-radius:4px; padding:5px 10px; cursor:pointer;}
.close-btn:hover {background:#333;}
</style>
</head>
<body>
<div class="container">
  <h2>Xin ch√†o, Qu·∫£n tr·ªã vi√™n</h2>
<button onclick="goHome()">Trang ch·ªß</button>
  <h3>C·∫•p quy·ªÅn b√°c sƒ©</h3>
  <div>
    <input type="text" id="docName" placeholder="T√™n b√°c sƒ©">
    <input type="text" id="docPhone" placeholder="S·ªë ƒëi·ªán tho·∫°i">
    <input type="password" id="docPass" placeholder="M·∫≠t kh·∫©u (t√πy ch·ªçn)">
    <br>
    <button onclick="grantDoctorRole(); displayUsers();">C·∫•p quy·ªÅn</button>
  </div>
  <hr>

  <button onclick="showPatientsList()">üìã Danh s√°ch b·ªánh nh√¢n</button>
  <hr>

  <h3>Danh s√°ch ng∆∞·ªùi d√πng hi·ªán t·∫°i</h3>
  <div id="userList"></div>
</div>

<!-- Modal danh s√°ch b·ªánh nh√¢n -->
<div id="patientListModal" class="modal">
  <div class="modal-content">
    <button class="close-btn" onclick="closePatientList()">ƒê√≥ng ‚úñ</button>
    <h2>Danh s√°ch b·ªánh nh√¢n & h·ªì s∆° kh√°m</h2>
    <div id="patientListContainer"></div>
  </div>
</div>

<script src="script.js" defer></script>
<script>
window.addEventListener("DOMContentLoaded", () => {
  checkAdmin();
  displayUsers();
});

function displayUsers(){
  const users = loadData("users") || [];
  const container = $("userList");
  let html = `<table class="user-table">
    <tr><th>T√™n</th><th>SƒêT</th><th>Vai tr√≤</th><th>Thao t√°c</th></tr>`;
  users.forEach(u => {
    html += `<tr>
      <td>${u.name}</td>
      <td>${u.phone}</td>
      <td>${u.role}</td>
      <td><button onclick="deleteUser('${u.phone}')">X√≥a</button></td>
    </tr>`;
  });
  html += "</table>";
  container.innerHTML = html;
}

function deleteUser(phone){
  if(!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i kho·∫£n n√†y kh√¥ng?")) return;
  let users = loadData("users") || [];
  users = users.filter(u => u.phone !== phone);
  saveData("users", users);
  alert("ƒê√£ x√≥a t√†i kho·∫£n th√†nh c√¥ng!");
  displayUsers();
}

// Popup danh s√°ch b·ªánh nh√¢n
function showPatientsList(){
  const patients = loadData("users").filter(u => u.role === "patient");
  const appointments = loadData("appointments") || [];
  const container = $("patientListContainer");

  if(patients.length === 0){
    container.innerHTML = "<p>Ch∆∞a c√≥ b·ªánh nh√¢n n√†o.</p>";
  } else {
    let html = `<table>
      <tr><th>T√™n</th><th>SƒêT</th><th>L·ªãch kh√°m</th></tr>`;
    patients.forEach(p => {
      const patientAppointments = appointments.filter(a => a.phone === p.phone);
      let appointmentHtml = patientAppointments.length === 0 ? "-" :
        "<ul>" + patientAppointments.map(a => `<li>${a.date} ‚Äî ${a.spec} ‚Äî B√°c sƒ©: ${a.doctor || "-"}</li>`).join("") + "</ul>";
      html += `<tr>
        <td>${p.name}</td>
        <td>${p.phone}</td>
        <td>${appointmentHtml}</td>
      </tr>`;
    });
    html += "</table>";
    container.innerHTML = html;
  }

  $("patientListModal").style.display = "block";
}

function closePatientList(){
  $("patientListModal").style.display = "none";
}
</script>
</body>
</html>
